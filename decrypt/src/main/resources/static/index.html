<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decryption Request</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <style>
        .output-box {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            background-color: #f9f9f9;
            transition: box-shadow 0.3s ease;
        }

        .output-box:focus {
            box-shadow: 0 0 5px rgba(81, 203, 238, 1);
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body class="p-8">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
        <textarea id="encryptedText" placeholder="请输入" rows="2" cols="20" class="output-box w-full"></textarea>
        <button onclick="sendDecryptionRequest()" class="btn mt-2">解密</button>
    </div>
    <div>
        <textarea id="result" rows="2" cols="100" class="output-box w-full"></textarea>
        <button onclick="formatJson()" class="btn mt-2">格式化</button>
    </div>
</div>
<div>
    <h3 class="text-xl font-bold mb-2">格式化结果：</h3>
    <textarea class="output-box w-full" id="outputText" rows="100" cols="100"></textarea>
</div>

<script>
    function sendDecryptionRequest() {
        // 获取输入框中的加密文本
        const encryptedText = document.getElementById('encryptedText').value;

        // 发送 POST 请求到 /descode 路径
        fetch('/test', {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain'
            },
            // 将加密文本作为 JSON 数据发送
            body: encryptedText
        })
            .then(response => response.text())
            .then(data => {
                console.log("输出：", data);
                // 显示解密后的文本
                const resultDiv = document.getElementById('result');
                resultDiv.textContent = `${data}`;

                // 在这里直接调用格式化函数
                formatJson();
            })
            .catch(error => {
                // 处理请求过程中的错误
                console.error('Error:', error);
            });
    }

    function formatJson() {
        // 获取输入内容
        const inputText = document.getElementById('result').value;

        try {
            // 解析输入的 JSON 字符串
            const jsonData = JSON.parse(inputText);

            // 格式化 JSON（缩进 2 个空格）
            const formattedJson = JSON.stringify(jsonData, null, 2);

            // 显示格式化结果
            document.getElementById('outputText').value = formattedJson;
        } catch (error) {
            // 处理解析错误
            document.getElementById('outputText').value = "无效的 JSON 格式！错误信息：" + error.message;
        }
    }
</script>
</body>

</html>
